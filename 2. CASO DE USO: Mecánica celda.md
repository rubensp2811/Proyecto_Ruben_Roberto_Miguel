## CASO DE USO: Mecánica celda
Version 1.0    Fecha/22/10/25
Autor: 

Descripción: 

# Casos de Uso — Buscaminas
**Versión del documento:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

---

## Índice
- Caso de Uso: Jugar
- Caso de Uso: Configurar Partida
- Caso de Uso: Generar Tablero
- Caso de Uso: Primera casilla segura (extiende Generar Tablero)
- Caso de Uso: Seleccionar Celda (Presionar Celda)
- Caso de Uso: Revelar Celda
- Caso de Uso: Flood Reveal (Revelado en cascada)
- Caso de Uso: Marcar Celda (Bandera)
- Caso de Uso: Comprobar Victoria/Derrota
- Caso de Uso: Guardar Partida / Continuar Partida
- Caso de Uso: Reiniciar Partida
- Caso de Uso: Mostrar Resultados / Tabla de Récords

---

## Caso de Uso: Jugar  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Iniciar y jugar una partida de buscaminas hasta victoria o derrota.

**Actores:**  
- Jugador

**Precondición:**  
- El jugador selecciona nivel/dificultad o configura tamaño y minas.

**Flujo Principal:**  
1. Usuario selecciona **Jugar** en el menú.  
2. Sistema crea/obtiene configuración del tablero (filas, columnas, minas).  
3. Se crea tablero vacío (sin minas colocadas aún si se usa primera-casilla-segura).  
4. Usuario selecciona una celda (clic corto).  
5. Si las minas no están colocadas, el sistema genera minas (respetando primera-casilla-segura si aplica).  
6. Sistema revela la celda (si es 0 → revelar en cascada).  
7. El jugador continúa seleccionando o marcando casillas hasta que se cumple victoria o se explota una mina.  
8. Al final, se muestra pantalla de resultado (victoria/derrota).

**Flujos Alternativos:**  
- Paso 4: Pulsación larga / clic derecho → ir a **Marcar Celda**.  
- Paso 6: Si la celda es mina → terminar partida (derrota).  
- En cualquier momento: jugador puede pausar, reiniciar, guardar o salir.

**Postcondición:**  
- Estado final de la partida guardado en memoria y mostrada la pantalla de resultados.

**Requisitos especiales:**  
- El cronómetro inicia con la primera acción del jugador.  
- Contador de minas actualiza según banderas.

---

## Caso de Uso: Configurar Partida  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Permitir al jugador definir dificultad, tamaño del tablero y número de minas.

**Actores:**  
- Jugador

**Precondición:**  
- El jugador está en el menú principal o en ajustes.

**Flujo Principal:**  
1. Usuario abre opciones/ajustes o selecciona modo "Personalizado".  
2. Usuario elige Tamaño (filas × columnas).  
3. Usuario elige Cantidad de minas o dificultad predefinida (Fácil/Medio/Experto).  
4. Usuario confirma configuración.  
5. Sistema valida que minas < (filas * columnas).  
6. Sistema guarda la configuración para la próxima partida.

**Flujos Alternativos:**  
- 5: Si la validación falla → mostrar mensaje de error y solicitar corrección.

**Postcondición:**  
- Configuración lista para iniciar una nueva partida.

---

## Caso de Uso: Generar Tablero  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Colocar minas aleatoriamente en el tablero y calcular números adyacentes.

**Actores:**  
- Sistema (invocado por Game/Board)

**Precondición:**  
- Tablero creado (celdas inicializadas) y, opcionalmente, primera casilla seleccionada si se usa primera-casilla-segura.

**Flujo Principal:**  
1. Recibir dimensiones del tablero y número de minas.  
2. Generar lista de posiciones válidas (excluyendo posición del primer clic si aplica).  
3. Barajar lista y seleccionar N posiciones para minas.  
4. Marcar celdas como minas.  
5. Calcular `adjacentMines` para cada celda no-mina.  
6. Marcar `minesPlaced = true`.

**Flujos Alternativos:**  
- Si no hay suficientes posiciones válidas → error de configuración (volver a Configurar Partida).

**Postcondición:**  
- Minas colocadas y adyacencias calculadas.

**Extiende / Incluye:**  
- `<<extend>> Primera casilla segura` (opcional: asegura que primera celda no sea mina).

---

## Caso de Uso: Primera casilla segura (extiende Generar Tablero)  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Garantiza que la primera celda revelada por el jugador no contenga mina.

**Actores:**  
- Sistema

**Precondición:**  
- Es la primera revelación de la partida.

**Flujo Principal:**  
1. Recibir coordenada del primer clic.  
2. Excluir coordenada (y opcionalmente sus vecinos) de la lista de posiciones para minas.  
3. Generar minas entre las posiciones restantes.  
4. Continuar con `Generar Tablero`.

**Postcondición:**  
- Primera celda segura para el jugador.

---

## Caso de Uso: Seleccionar Celda (Presionar Celda)  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Acción del jugador al hacer clic en una celda: revelar o actuar según su estado.

**Actores:**  
- Jugador

**Precondición:**  
- Partida en curso; celda no revelada o marcada.

**Flujo Principal:**  
1. Jugador realiza clic izquierdo en una celda.  
2. Sistema verifica si la celda está marcada → si está marcada, impedir revelar.  
3. Si minas no colocadas → invocar `Generar Tablero` (primera casilla segura).  
4. Invocar `Revelar Celda`.  
5. Actualizar vista/estado de la celda.

**Flujos Alternativos:**  
- Si la celda está marcada → mostrar notificación o ignorar clic.  
- Si la celda ya está revelada → (opcional) permitir “chording” (revelado por comprobación de banderas).

**Postcondición:**  
- Celda revelada o acción bloqueada por bandera.

---

## Caso de Uso: Revelar Celda  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Revelar el contenido de una celda: número, espacio vacío o mina; aplicar cascada si procede.

**Actores:**  
- Sistema (invocado por Seleccionar Celda)

**Precondición:**  
- Celda válida, no marcada ni ya revelada.

**Flujo Principal:**  
1. Si la celda es mina → marcar detonación, finalizar partida (derrota).  
2. Si la celda tiene `adjacentMines > 0` → mostrar número y terminar.  
3. Si la celda tiene `adjacentMines == 0` → realizar **Flood Reveal** (revelado en cascada) sobre vecinos.  
4. Actualizar contador de celdas reveladas.

**Flujos Alternativos:**  
- Caso de detonación → mostrar animación de mina y mensajes de derrota.  
- Caso de cascada → revelar bordes con números y continuar el juego.

**Postcondición:**  
- Estado de tablero actualizado (posiblemente varias celdas reveladas).

---

## Caso de Uso: Flood Reveal (Revelado en cascada) — puede ser parte de Revelar Celda  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Revelar recursiva/iterativamente todas las celdas conectadas sin minas adyacentes (valor 0) y sus fronteras.

**Actores:**  
- Sistema

**Precondición:**  
- Se invoca por una celda con `adjacentMines == 0`.

**Flujo Principal:**  
1. Iniciar cola/stack con la celda inicial.  
2. Mientras cola no vacía: sacar celda, revelar si no está revelada, si su `adjacentMines==0` añadir vecinos.  
3. Revelar también las celdas frontera (aquellas con `adjacentMines > 0`).  
4. Terminar cuando no queden vecinos por procesar.

**Postcondición:**  
- Todas las celdas conectadas y fronteras reveladas.

---

## Caso de Uso: Marcar Celda (Bandera)  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Marcar o desmarcar una celda con una bandera para indicar sospecha de mina.

**Actores:**  
- Jugador

**Precondición:**  
- Celda no revelada.

**Flujo Principal:**  
1. Jugador realiza pulsación larga o clic derecho en una celda.  
2. Sistema alterna el estado bandera (poner / quitar).  
3. Actualizar contador de minas restantes (totalMinas - banderasColocadas).  
4. Actualizar la vista de la celda.

**Flujos Alternativos:**  
- Si la celda ya está revelada → no se permite marcar; mostrar notificación.

**Postcondición:**  
- Celda marcada o desmarcada; contador actualizado.

---

## Caso de Uso: Comprobar Victoria/Derrota  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Verificar tras cada acción si se ha ganado o perdido la partida.

**Actores:**  
- Sistema

**Precondición:**  
- Se ha revelado una celda o se ha colocado/retirado una bandera.

**Flujo Principal:**  
1. Si se revela una mina → marcar derrota y finalizar.  
2. Si `revealedCount == rows*cols - totalMines` → marcar victoria.  
3. En victoria → mostrar pantalla de resultado y registrar tiempo/puntos.  
4. En derrota → mostrar tablero con minas reveladas y option de reinicio/guardar.

**Postcondición:**  
- Estado de la partida: `isWon` o `isLost`.

---

## Caso de Uso: Guardar Partida / Continuar Partida  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Permite guardar el estado actual de la partida y recargarlo luego.

**Actores:**  
- Jugador  
- Sistema de ficheros (implícito)

**Precondición:**  
- Partida en curso.

**Flujo Principal:**  
1. Jugador selecciona “Guardar” o el sistema autoguarda.  
2. Serializar estado del tablero (posiciones de minas, estados de celdas, tiempo transcurrido, flags).  
3. Guardar fichero JSON o binario en almacenamiento local.  
4. Para cargar: leer fichero, reconstruir objetos `Board` y `Cell`, restaurar tiempo y banderas.

**Flujos Alternativos:**  
- Si el fichero no se puede escribir → mostrar error y proponer ruta alternativa.

**Postcondición:**  
- Partida almacenada y posible reanudación posterior.

---

## Caso de Uso: Reiniciar Partida  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Reiniciar el tablero actual (misma configuración) a estado inicial.

**Actores:**  
- Jugador

**Precondición:**  
- Partida en curso o finalizada.

**Flujo Principal:**  
1. Usuario pulsa botón *Reiniciar*.  
2. Sistema confirma acción (opcional).  
3. Crear tablero nuevo con la misma configuración (filas/cols/minas).  
4. Reiniciar cronómetro y contadores.

**Flujos Alternativos:**  
- Confirmación → si usuario cancela → volver a la partida actual.

**Postcondición:**  
- Partida nueva iniciada.

---

## Caso de Uso: Mostrar Resultados / Tabla de Récords  
**Versión:** 1.0  
**Fecha:** 22/10/25  
**Autor:** Equipo Buscaminas

**Descripción:**  
Almacenar y mostrar los mejores tiempos/estadísticas por nivel.

**Actores:**  
- Jugador  
- Sistema (persistencia)

**Precondición:**  
- Una partida finalizó (victoria).

**Flujo Principal:**  
1. Al ganar, pedir nombre/jugador (opcional).  
2. Registrar tiempo y datos de la partida en `scores.json`.  
3. Ordenar tabla por tiempo y mostrar top N por nivel.  
4. Desde menú el jugador puede acceder a tabla de récords.

**Flujos Alternativos:**  
- Si archivo de scores no existe → crear nuevo.

**Postcondición:**  
- Tabla de récords actualizada.

---
